<!--
Copyright 2011 Florian Pons (florian.pons.tv). All Rights Reserved.

Licensed under the Cecill License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

     http://www.cecill.info/licences/Licence_CeCILL_V2-en.txt

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS-IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>sylvester</title>
	<script src="./sylvester/sylv.js"></script>
	<script src="./sylvester/ui/ui.js"></script>
	<script src="./sylvester/process/process.js"></script>
	<script src="./sylvester/estim/estim.js"></script>
	<script src="./flot/jquery.min.js"></script>
	<script src="./flot/jquery.flot.js"></script>
	<script type="text/javascript">
		function exportAll() {
			document.getElementById("consoleIn").value = sylv.ui.extractAll();
		};
		sylv.ui.print = function(val, nl) {
			var txt = val?val.toString():"";
			var cnsl = document.getElementById("consoleOut"+print.nb);
			cnsl.innerHTML=txt.replace(/\n/g,"<br/>")+(nl?"<br/>":"")+cnsl.innerHTML; 
		};
		function print(val) {sylv.ui.print(val, true)};
		print.nb = 0;
		function execute() {
			var cmd = document.getElementById("consoleIn");
			sylv.ui.print("<hr/>", false);
			$("#consoleOut"+print.nb).before('<div id="consoleOut'+(++print.nb)+'"></div>');
			if(cmd.value) print(eval(cmd.value));
			historyNav.buff[historyNav.buff.length-1]=cmd.value;
			cmd.value = "";
			historyNav.buff.push("");
			historyNav.pos = historyNav.buff.length-1;
		};
		function historyNav(e) {
			switch(e.keyCode) {
				case 38:
					var cmd = document.getElementById("consoleIn");
					if(historyNav.pos==historyNav.buff.length-1) historyNav.buff[historyNav.pos]=cmd.value;
					historyNav.pos--;
					if(historyNav.pos<0) historyNav.pos=0;
					cmd.value = historyNav.buff[historyNav.pos];
					break;
				case 40:
					var cmd = document.getElementById("consoleIn");
					historyNav.pos++;
					if(historyNav.pos>historyNav.buff.length-1) historyNav.pos=historyNav.buff.length-1;
					cmd.value = historyNav.buff[historyNav.pos];
					break;
			};
		};
		historyNav.pos = 0;
		historyNav.buff = [""];
		function plot() {
			var cmd = document.getElementById("consoleIn");
			sylv.ui.print("<hr/>", false);
			$("#consoleOut"+print.nb).before('<div id="consoleOut'+(++print.nb)+'" style="width:600px;height:300px;"></div>');
			var mtx = eval(cmd.value);
			historyNav.buff[historyNav.buff.length-1]=cmd.value;
			cmd.value = "";
			historyNav.buff.push("");
			historyNav.pos = historyNav.buff.length-1;
			
			var cnsl = document.getElementById("consoleOut"+print.nb);
			//cnsl.innerHTML = '<div name="placeholder'+plot.nb+'" id="placeholder'+plot.nb+'" style="width:600px;height:300px;"><div/>'+cnsl.innerHTML; 
			var data = [];
			var size = mtx[0].length;
			for (var i = 1; i<mtx.length; i++) {
				var ligne = [];
				for (var j = 0; j<size; j++) {
					ligne.push([mtx[0][j],mtx[i][j]]);
				};
				data.push(ligne);
			};
			$.plot($("#consoleOut"+print.nb), data);
			$("#consoleOut"+print.nb).before('<div id="consoleOut'+(++print.nb)+'"></div>');
		};
	</script> 
</head>
<body>
	<h1>sylv finance</h1>
	<button type="button" onclick="javascript: exportAll()">
		export
	</button>
	<br/>
	<textarea name="consoleIn" id="consoleIn" onKeyDown="javascript: historyNav(event)" rows="10" cols="50"></textarea>
	<br/>
	<button type="button" onclick="javascript: execute()">
		execute
	</button>
	<button type="button" onclick="javascript: plot()">
		plot
	</button>
	<div id="consoleOut0">
		Wellcome in Sylvester
	</div>
</body>
</html>
